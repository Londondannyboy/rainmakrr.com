---
import { sql } from '../lib/db';

// Fetch top placement agents
const topAgents = await sql`
  SELECT
    name,
    COALESCE(display_name, name) as display_name,
    slug,
    primary_country,
    primary_region,
    specializations,
    global_rank,
    payload->'headquarters_city' as headquarters_city,
    payload->'employee_range' as employee_range
  FROM companies
  WHERE company_type = 'placement_agent'
    AND tags && ARRAY['top']
  ORDER BY
    CASE WHEN global_rank IS NOT NULL THEN 0 ELSE 1 END,
    global_rank ASC NULLS LAST,
    name ASC
  LIMIT 15
`;

// Industry estimates for top placement agents (based on Preqin 2025 and industry research)
const agentEstimates: Record<string, any> = {
  'campbell-lutyens': {
    yearFounded: 1988,
    estRaisedTotal: '$500B+',
    typicalFundSize: '$500M - $5B',
    specializations: ['Private Equity', 'Infrastructure', 'Private Credit', 'Real Estate'],
    preqinRank: 1
  },
  'pjt-park-hill': {
    yearFounded: 2015,
    estRaisedTotal: '$300B+',
    typicalFundSize: '$500M - $3B',
    specializations: ['Private Equity', 'Real Estate', 'Hedge Funds'],
    preqinRank: 2
  },
  'lazard': {
    yearFounded: 1848,
    estRaisedTotal: '$250B+',
    typicalFundSize: '$500M - $5B',
    specializations: ['Private Equity', 'Infrastructure', 'Private Credit'],
    preqinRank: 5
  },
  'eaton-partners': {
    yearFounded: 1983,
    estRaisedTotal: '$400B+',
    typicalFundSize: '$300M - $3B',
    specializations: ['Private Equity', 'Real Estate', 'Infrastructure'],
    preqinRank: 3
  },
  'greenhill': {
    yearFounded: 1996,
    estRaisedTotal: '$200B+',
    typicalFundSize: '$500M - $2B',
    specializations: ['Private Equity', 'Real Estate'],
    preqinRank: null
  },
  'jefferies': {
    yearFounded: 1962,
    estRaisedTotal: '$150B+',
    typicalFundSize: '$300M - $2B',
    specializations: ['Private Equity', 'Real Estate', 'Private Credit'],
    preqinRank: null
  },
  'hl': {
    yearFounded: 2005,
    estRaisedTotal: '$100B+',
    typicalFundSize: '$200M - $1B',
    specializations: ['Private Equity', 'Venture Capital'],
    preqinRank: null
  },
  'mvision': {
    yearFounded: 2009,
    estRaisedTotal: '$180B+',
    typicalFundSize: '$300M - $2B',
    specializations: ['Private Equity', 'Infrastructure', 'Real Estate'],
    preqinRank: 4
  },
  'evercore': {
    yearFounded: 1995,
    estRaisedTotal: '$120B+',
    typicalFundSize: '$500M - $2B',
    specializations: ['Private Equity', 'Private Credit'],
    preqinRank: null
  },
  'goldmansachs': {
    yearFounded: 1869,
    estRaisedTotal: '$200B+',
    typicalFundSize: '$500M - $5B',
    specializations: ['Private Equity', 'Real Estate', 'Infrastructure', 'Private Credit'],
    preqinRank: null
  }
};

// Merge database data with estimates
const tableData = topAgents.map((agent: any) => {
  const estimates = agentEstimates[agent.slug] || {};
  return {
    ...agent,
    yearFounded: estimates.yearFounded || null,
    estRaisedTotal: estimates.estRaisedTotal || 'N/A',
    typicalFundSize: estimates.typicalFundSize || 'N/A',
    specializations: estimates.specializations || (agent.specializations || []),
    preqinRank: estimates.preqinRank
  };
});
---

<section class="comparison-table-section" style="padding: 80px 60px; background: linear-gradient(180deg, rgba(0, 0, 0, 0.95) 0%, rgba(15, 15, 30, 0.98) 100%);">
  <div style="max-width: 1600px; margin: 0 auto;">
    <div class="section-header" style="text-align: center; margin-bottom: 48px;">
      <h2 style="font-size: 42px; font-weight: 900; margin-bottom: 16px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); background-clip: text; -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
        Top Placement Agents Comparison
      </h2>
      <p style="font-size: 18px; line-height: 1.7; color: rgba(255, 255, 255, 0.8); max-width: 900px; margin: 0 auto;">
        Comprehensive comparison of the world's leading private equity placement agents, including Preqin 2025 rankings, estimated funds raised, and strategy focus.
      </p>
    </div>

    <div style="overflow-x: auto; background: rgba(255, 255, 255, 0.02); border-radius: 16px; border: 1px solid rgba(255, 255, 255, 0.1);">
      <table class="comparison-table" style="width: 100%; border-collapse: collapse; min-width: 1200px;">
        <thead>
          <tr style="background: rgba(102, 126, 234, 0.1); border-bottom: 2px solid rgba(102, 126, 234, 0.3);">
            <th style="padding: 20px 24px; text-align: left; font-size: 14px; font-weight: 700; color: #667eea; text-transform: uppercase; letter-spacing: 1px;">
              Rank
            </th>
            <th style="padding: 20px 24px; text-align: left; font-size: 14px; font-weight: 700; color: #667eea; text-transform: uppercase; letter-spacing: 1px;">
              Firm Name
            </th>
            <th style="padding: 20px 24px; text-align: left; font-size: 14px; font-weight: 700; color: #667eea; text-transform: uppercase; letter-spacing: 1px;">
              HQ Location
            </th>
            <th style="padding: 20px 24px; text-align: left; font-size: 14px; font-weight: 700; color: #667eea; text-transform: uppercase; letter-spacing: 1px;">
              Year Founded
            </th>
            <th style="padding: 20px 24px; text-align: left; font-size: 14px; font-weight: 700; color: #667eea; text-transform: uppercase; letter-spacing: 1px;">
              Est. Funds Raised
            </th>
            <th style="padding: 20px 24px; text-align: left; font-size: 14px; font-weight: 700; color: #667eea; text-transform: uppercase; letter-spacing: 1px;">
              Typical Fund Size
            </th>
            <th style="padding: 20px 24px; text-align: left; font-size: 14px; font-weight: 700; color: #667eea; text-transform: uppercase; letter-spacing: 1px;">
              Strategy Focus
            </th>
          </tr>
        </thead>
        <tbody>
          {tableData.map((agent: any, index: number) => (
            <tr style="border-bottom: 1px solid rgba(255, 255, 255, 0.05); transition: background 0.3s;" class="table-row">
              <td style="padding: 24px; font-size: 15px; color: rgba(255, 255, 255, 0.9); font-weight: 700;">
                {agent.preqinRank ? (
                  <span style="display: inline-flex; align-items: center; gap: 6px; background: rgba(102, 126, 234, 0.2); color: #667eea; padding: 6px 12px; border-radius: 6px; font-size: 14px;">
                    #{agent.preqinRank}
                    <span style="font-size: 11px; font-weight: 600; opacity: 0.8;">Preqin</span>
                  </span>
                ) : (
                  <span style="color: rgba(255, 255, 255, 0.4);">—</span>
                )}
              </td>
              <td style="padding: 24px;">
                <a href={`/private-equity-placement-agents-list/${agent.slug}`} style="color: #fff; text-decoration: none; font-weight: 600; font-size: 16px; display: block; transition: color 0.3s;" class="firm-link">
                  {agent.display_name}
                </a>
              </td>
              <td style="padding: 24px; font-size: 15px; color: rgba(255, 255, 255, 0.8);">
                {agent.headquarters_city ? `${agent.headquarters_city}, ${agent.primary_country}` : agent.primary_country}
              </td>
              <td style="padding: 24px; font-size: 15px; color: rgba(255, 255, 255, 0.8);">
                {agent.yearFounded || <span style="color: rgba(255, 255, 255, 0.4);">N/A</span>}
              </td>
              <td style="padding: 24px; font-size: 15px; color: rgba(255, 255, 255, 0.9); font-weight: 600;">
                {agent.estRaisedTotal}
              </td>
              <td style="padding: 24px; font-size: 15px; color: rgba(255, 255, 255, 0.8);">
                {agent.typicalFundSize}
              </td>
              <td style="padding: 24px; font-size: 14px; color: rgba(255, 255, 255, 0.7);">
                <div style="display: flex; flex-wrap: wrap; gap: 6px;">
                  {agent.specializations && agent.specializations.length > 0 ? (
                    agent.specializations.slice(0, 3).map((spec: string) => (
                      <span style="background: rgba(255, 255, 255, 0.1); padding: 4px 10px; border-radius: 4px; font-size: 12px; white-space: nowrap;">
                        {spec}
                      </span>
                    ))
                  ) : (
                    <span style="color: rgba(255, 255, 255, 0.4);">—</span>
                  )}
                </div>
              </td>
            </tr>
          ))}
        </tbody>
      </table>
    </div>

    <div style="margin-top: 32px; padding: 24px; background: rgba(102, 126, 234, 0.05); border-left: 4px solid #667eea; border-radius: 8px;">
      <p style="font-size: 14px; line-height: 1.7; color: rgba(255, 255, 255, 0.7); margin: 0;">
        <strong style="color: rgba(255, 255, 255, 0.9);">Data Sources:</strong> Rankings from <a href="https://www.preqin.com" target="_blank" rel="noopener" style="color: #667eea; text-decoration: underline;">Preqin 2025 Global Placement Agent Rankings</a>.
        Estimated funds raised and typical fund sizes based on industry research, <a href="https://www.privateequitymarketeer.com/placement-agents" target="_blank" rel="noopener" style="color: #667eea; text-decoration: underline;">Private Equity Marketeer</a>, and publicly available transaction data.
        Visit individual firm profiles for detailed information.
      </p>
    </div>
  </div>
</section>

<style>
  .table-row:hover {
    background: rgba(102, 126, 234, 0.05) !important;
  }

  .firm-link:hover {
    color: #667eea !important;
  }

  @media (max-width: 768px) {
    .comparison-table-section {
      padding: 60px 20px !important;
    }
  }
</style>

<!-- Table Schema Markup -->
<script type="application/ld+json" set:html={JSON.stringify({
  "@context": "https://schema.org",
  "@type": "Table",
  "about": {
    "@type": "Thing",
    "name": "Top Private Equity Placement Agents Comparison",
    "description": "Comprehensive comparison of the world's leading private equity placement agents including Preqin rankings, funds raised, and specializations"
  },
  "data": {
    "@type": "DataFeed",
    "dataFeedElement": tableData.map((agent: any, index: number) => ({
      "@type": "DataFeedItem",
      "position": index + 1,
      "item": {
        "@type": "Organization",
        "name": agent.display_name,
        "url": `https://placement.quest/private-equity-placement-agents-list/${agent.slug}`,
        "location": {
          "@type": "Place",
          "address": {
            "@type": "PostalAddress",
            "addressLocality": agent.headquarters_city,
            "addressCountry": agent.primary_country
          }
        },
        "foundingDate": agent.yearFounded ? agent.yearFounded.toString() : undefined,
        "knowsAbout": agent.specializations
      }
    }))
  }
})} />
