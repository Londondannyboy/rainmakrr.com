---
/**
 * Placement Agent News - BBC-style Layout
 * =======================================
 * Clean, classic news layout with white background
 */
import { sql } from '../../lib/db';
import SEO from '../../components/SEO.astro';
import Schema from '../../components/Schema.astro';
import OptimizedFonts from '../../components/OptimizedFonts.astro';
import Navigation from '../../components/Navigation.astro';

// Fetch featured articles (1 for hero)
const featuredArticles = await sql`
  SELECT
    id, title, excerpt, slug, published_at, created_at,
    article_angle, featured_asset_url, featured_asset_alt,
    video_playback_id, country, view_count
  FROM articles
  WHERE app = 'rainmakrr'
    AND status = 'published'
    AND is_featured = true
  ORDER BY published_at DESC NULLS LAST
  LIMIT 1
`;

const featuredArticle = featuredArticles[0] || null;

// Fetch all other published articles
const articles = await sql`
  SELECT
    id, title, excerpt, slug, published_at, created_at,
    article_angle, featured_asset_url, featured_asset_alt,
    video_playback_id, country, view_count
  FROM articles
  WHERE app = 'rainmakrr'
    AND status = 'published'
    AND is_featured = false
  ORDER BY published_at DESC NULLS LAST, created_at DESC
`;

// Fetch top placement agents
const agents = await sql`
  SELECT id, name, slug, description, logo_url, location
  FROM companies
  WHERE app = 'rainmakrr'
    AND status = 'published'
  ORDER BY created_at DESC
  LIMIT 6
`;

// Helper: get thumbnail URL
function getThumbnail(article: any): string | null {
  if (article.video_playback_id) {
    return `https://image.mux.com/${article.video_playback_id}/thumbnail.webp?time=1&width=600&quality=70`;
  }
  return article.featured_asset_url || null;
}

// Helper: relative time
function timeAgo(date: string | Date | null): string {
  if (!date) return '';
  const now = new Date();
  const then = new Date(date);
  const diffHours = Math.floor((now.getTime() - then.getTime()) / (1000 * 60 * 60));
  if (diffHours < 1) return 'Just now';
  if (diffHours < 24) return `${diffHours}h ago`;
  const diffDays = Math.floor(diffHours / 24);
  if (diffDays === 1) return '1 day ago';
  if (diffDays < 7) return `${diffDays} days ago`;
  return then.toLocaleDateString('en-US', { day: 'numeric', month: 'short', year: 'numeric' });
}
---

<!DOCTYPE html>
<html lang="en">
<head>
  <SEO
    title="Placement Agent News"
    description="Latest news and insights on private equity placement agents, fundraising, and capital markets"
  />
  <Schema type="article_list" />
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <OptimizedFonts />
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: #fff;
      color: #1a1a1a;
      line-height: 1.6;
    }
    .news-item:hover .news-title { color: #1d4ed8; }
    .news-item:hover img { opacity: 0.9; }
  </style>
</head>
<body>
  <Navigation />

  <!-- Hero Banner -->
  <section style="background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 50%, #0f172a 100%); color: #fff; padding: 100px 20px 80px; position: relative; overflow: hidden;">
    <div style="position: absolute; inset: 0; overflow: hidden;">
      <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 600px; height: 400px; background: rgba(99, 102, 241, 0.2); border-radius: 50%; filter: blur(120px);"></div>
    </div>
    <div style="max-width: 1200px; margin: 0 auto; position: relative; z-index: 1; text-align: center;">
      <h1 style="font-size: clamp(40px, 8vw, 80px); font-weight: 800; letter-spacing: -0.02em; margin-bottom: 12px; text-shadow: 0 0 60px rgba(99, 102, 241, 0.5);">
        Placement Agent
      </h1>
      <p style="font-size: clamp(20px, 3vw, 32px); font-weight: 500; color: #a5b4fc;">News</p>
    </div>
  </section>

  <main style="max-width: 1200px; margin: 0 auto; padding: 32px 20px;">

    <!-- Featured Article -->
    {featuredArticle && (
      <section style="margin-bottom: 40px; padding-bottom: 40px; border-bottom: 1px solid #e5e7eb;">
        <a href={`/${featuredArticle.slug}`} style="display: grid; grid-template-columns: 1fr 1fr; gap: 32px; text-decoration: none; color: inherit; align-items: start;">
          {getThumbnail(featuredArticle) && (
            <img
              src={getThumbnail(featuredArticle)}
              alt={featuredArticle.title}
              style="width: 100%; height: 300px; object-fit: cover;"
            />
          )}
          <div style="padding-top: 8px;">
            <h2 style="font-size: 28px; font-weight: 700; color: #1a1a1a; line-height: 1.3; margin-bottom: 16px;">
              {featuredArticle.title}
            </h2>
            {featuredArticle.excerpt && (
              <p style="font-size: 16px; color: #6b7280; line-height: 1.7; margin-bottom: 16px;">
                {featuredArticle.excerpt}
              </p>
            )}
            <span style="font-size: 14px; color: #9ca3af;">{timeAgo(featuredArticle.published_at || featuredArticle.created_at)}</span>
          </div>
        </a>
      </section>
    )}

    <div style="display: grid; grid-template-columns: 1fr 320px; gap: 48px;">

      <!-- Latest Updates -->
      <div>
        <h2 style="font-size: 20px; font-weight: 700; color: #1a1a1a; margin-bottom: 24px; padding-bottom: 8px; border-bottom: 4px solid #2563eb; display: inline-block;">Latest Updates</h2>

        <div style="display: flex; flex-direction: column; gap: 24px;">
          {articles.map((article: any) => (
            <a href={`/${article.slug}`} class="news-item" style="display: flex; gap: 16px; text-decoration: none; color: inherit;">
              {getThumbnail(article) ? (
                <img
                  src={getThumbnail(article)}
                  alt=""
                  style="width: 160px; height: 100px; object-fit: cover; flex-shrink: 0;"
                />
              ) : (
                <div style="width: 160px; height: 100px; background: #f3f4f6; flex-shrink: 0; display: flex; align-items: center; justify-content: center;">
                  <svg style="width: 32px; height: 32px; color: #d1d5db;" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14zm-5-7l-3 3.72L9 13l-3 4h12l-4-5z"/>
                  </svg>
                </div>
              )}
              <div style="flex: 1; min-width: 0;">
                <h3 class="news-title" style="font-size: 16px; font-weight: 600; color: #1a1a1a; line-height: 1.4; margin-bottom: 6px; transition: color 0.2s;">
                  {article.title}
                </h3>
                <p style="font-size: 14px; color: #6b7280; line-height: 1.5; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; margin-bottom: 6px;">
                  {article.excerpt}
                </p>
                <span style="font-size: 12px; color: #9ca3af;">{timeAgo(article.published_at || article.created_at)}</span>
              </div>
            </a>
          ))}
        </div>

        {articles.length === 0 && (
          <p style="color: #6b7280; padding: 40px 0;">No articles yet. Check back soon.</p>
        )}
      </div>

      <!-- Sidebar -->
      <aside>
        <h2 style="font-size: 20px; font-weight: 700; color: #1a1a1a; margin-bottom: 24px; padding-bottom: 8px; border-bottom: 4px solid #6366f1; display: inline-block;">Top Placement Agents</h2>

        {agents.length > 0 ? (
          <div style="display: flex; flex-direction: column; gap: 12px;">
            {agents.map((agent: any) => (
              <a href={`/companies/${agent.slug}`} style="display: flex; align-items: center; gap: 12px; padding: 12px; background: #f9fafb; border-radius: 8px; text-decoration: none; color: inherit; transition: background 0.2s;">
                {agent.logo_url ? (
                  <img src={agent.logo_url} alt={agent.name} style="width: 40px; height: 40px; object-fit: contain; border-radius: 4px;" />
                ) : (
                  <div style="width: 40px; height: 40px; background: #e0e7ff; border-radius: 4px; display: flex; align-items: center; justify-content: center;">
                    <span style="color: #4f46e5; font-weight: 700; font-size: 14px;">{agent.name?.charAt(0)}</span>
                  </div>
                )}
                <div style="flex: 1; min-width: 0;">
                  <h3 style="font-size: 14px; font-weight: 600; color: #1a1a1a; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">{agent.name}</h3>
                  {agent.location && (
                    <span style="font-size: 12px; color: #9ca3af;">{agent.location}</span>
                  )}
                </div>
              </a>
            ))}
          </div>
        ) : (
          <div style="background: #f9fafb; border-radius: 8px; padding: 24px; text-align: center;">
            <p style="font-size: 14px; color: #6b7280;">Directory coming soon</p>
          </div>
        )}

        <a href="/private-equity-placement-agents-list" style="display: block; margin-top: 16px; text-align: center; color: #2563eb; font-size: 14px; font-weight: 500; text-decoration: none;">
          View all agents →
        </a>

        <!-- CTA Box -->
        <div style="margin-top: 32px; background: #0f172a; color: #fff; border-radius: 12px; padding: 24px;">
          <h3 style="font-size: 18px; font-weight: 700; margin-bottom: 8px;">Stay Informed</h3>
          <p style="font-size: 14px; color: #94a3b8; margin-bottom: 16px;">Get the latest placement agent news and market insights.</p>
          <a href="/contact" style="display: block; background: #fff; color: #0f172a; text-align: center; padding: 10px 20px; border-radius: 6px; font-size: 14px; font-weight: 600; text-decoration: none;">
            Contact Us
          </a>
        </div>
      </aside>

    </div>
  </main>

  <!-- Footer -->
  <footer style="background: #f9fafb; border-top: 1px solid #e5e7eb; margin-top: 64px; padding: 48px 20px;">
    <div style="max-width: 1200px; margin: 0 auto; display: grid; grid-template-columns: repeat(4, 1fr); gap: 32px;">
      <div>
        <h3 style="font-size: 16px; font-weight: 700; color: #1a1a1a; margin-bottom: 16px;">Placement Agent</h3>
        <p style="font-size: 14px; color: #6b7280;">News and insights on private equity placement agents and capital markets.</p>
      </div>
      <div>
        <h4 style="font-size: 14px; font-weight: 600; color: #1a1a1a; margin-bottom: 12px;">Sections</h4>
        <ul style="list-style: none; font-size: 14px;">
          <li style="margin-bottom: 8px;"><a href="/private-equity-placement-agent-news" style="color: #6b7280; text-decoration: none;">News</a></li>
          <li style="margin-bottom: 8px;"><a href="/private-equity-placement-agents-list" style="color: #6b7280; text-decoration: none;">Directory</a></li>
          <li style="margin-bottom: 8px;"><a href="/resources" style="color: #6b7280; text-decoration: none;">Resources</a></li>
        </ul>
      </div>
      <div>
        <h4 style="font-size: 14px; font-weight: 600; color: #1a1a1a; margin-bottom: 12px;">Topics</h4>
        <ul style="list-style: none; font-size: 14px;">
          <li style="margin-bottom: 8px;"><a href="/private-equity-placement-agent-news" style="color: #6b7280; text-decoration: none;">Fundraising</a></li>
          <li style="margin-bottom: 8px;"><a href="/private-equity-placement-agent-news" style="color: #6b7280; text-decoration: none;">Market Analysis</a></li>
        </ul>
      </div>
      <div>
        <h4 style="font-size: 14px; font-weight: 600; color: #1a1a1a; margin-bottom: 12px;">Company</h4>
        <ul style="list-style: none; font-size: 14px;">
          <li style="margin-bottom: 8px;"><a href="/about" style="color: #6b7280; text-decoration: none;">About</a></li>
          <li style="margin-bottom: 8px;"><a href="/contact" style="color: #6b7280; text-decoration: none;">Contact</a></li>
        </ul>
      </div>
    </div>
    <div style="max-width: 1200px; margin: 32px auto 0; padding-top: 24px; border-top: 1px solid #e5e7eb; text-align: center;">
      <p style="font-size: 14px; color: #9ca3af;">© 2025 Placement Agent. All rights reserved.</p>
      <p style="font-size: 12px; color: #b0b0b0; margin-top: 16px; max-width: 800px; margin-left: auto; margin-right: auto; line-height: 1.6;">Rainmakrr is a financial news site. Nothing on this site should be considered financial advice.</p>
    </div>
  </footer>

  <style>
    @media (max-width: 1024px) {
      main > div { grid-template-columns: 1fr !important; }
      aside { order: -1; }
    }
    @media (max-width: 768px) {
      section[style*="grid-template-columns: 1fr 1fr"] { display: block !important; }
      section[style*="grid-template-columns: 1fr 1fr"] img { height: 200px !important; margin-bottom: 16px; }
      footer > div { grid-template-columns: 1fr 1fr !important; }
    }
    @media (max-width: 480px) {
      footer > div { grid-template-columns: 1fr !important; }
      .news-item img, .news-item > div:first-child { width: 100px !important; height: 70px !important; }
    }
  </style>
</body>
</html>
