---
/**
 * Company Visualizations Page
 *
 * Dedicated page for company-specific knowledge graph visualizations
 */
import { sql } from '../../lib/db';
import SEO from '../../components/SEO.astro';
import Navigation from '../../components/Navigation.astro';
import ZepGraph3D from '../../components/ZepGraph3D.astro';
import ZepGraphVisualization from '../../components/ZepGraphVisualization.astro';
import CompanyTimeline from '../../components/CompanyTimeline.astro';

// Fetch all companies with published status
const companies = await sql`
  SELECT
    id, name, slug,
    COALESCE(display_name, name) as display_name,
    description, headquarters,
    featured_asset_url, logo_url, global_rank
  FROM companies
  WHERE status = 'published' AND company_type = 'placement_agent'
  ORDER BY
    CASE WHEN global_rank IS NOT NULL THEN 0 ELSE 1 END,
    global_rank ASC NULLS LAST,
    name ASC
  LIMIT 20
`;
---

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <SEO
    title="Company Visualizations | Placement Agent Knowledge Graphs"
    description="Interactive 3D and 2D knowledge graph visualizations for top private equity placement agents. Explore deal networks, relationships, and timelines."
  />

  <link rel="preconnect" href="https://unpkg.com" crossorigin>
  <script src="https://unpkg.com/vis-network@9.1.9/standalone/umd/vis-network.min.js" defer></script>
  <script src="https://unpkg.com/3d-force-graph@1.79.0" defer></script>

  <style is:inline>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html { scroll-behavior: smooth; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(to bottom right, #020617, #0f172a, #020617);
      color: #f1f5f9;
      min-height: 100vh;
      line-height: 1.6;
    }
    a { color: inherit; text-decoration: none; }
    .container { max-width: 1400px; margin: 0 auto; padding: 0 1.5rem; }

    /* Hero */
    .hero {
      padding: 6rem 1.5rem 3rem;
      text-align: center;
      background: radial-gradient(ellipse at top, rgba(99, 102, 241, 0.15) 0%, transparent 50%);
    }
    .hero-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      background: rgba(99, 102, 241, 0.2);
      border: 1px solid rgba(99, 102, 241, 0.3);
      padding: 0.5rem 1rem;
      border-radius: 100px;
      font-size: 0.8rem;
      color: #a5b4fc;
      margin-bottom: 1.5rem;
    }
    .hero h1 {
      font-size: clamp(2rem, 5vw, 3rem);
      font-weight: 800;
      margin-bottom: 1rem;
      background: linear-gradient(to right, #fff, #a5b4fc);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .hero p {
      font-size: 1rem;
      color: #94a3b8;
      max-width: 600px;
      margin: 0 auto;
    }

    /* Company Card */
    .company-card {
      background: rgba(15, 23, 42, 0.6);
      border: 1px solid rgba(51, 65, 85, 0.5);
      border-radius: 1rem;
      padding: 1.5rem;
      margin-bottom: 2rem;
      transition: border-color 0.3s;
    }
    .company-card:hover {
      border-color: rgba(99, 102, 241, 0.5);
    }
    .company-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
      gap: 1rem;
    }
    .company-info {
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    .company-avatar {
      width: 3.5rem;
      height: 3.5rem;
      border-radius: 0.75rem;
      background: linear-gradient(135deg, #6366f1, #8b5cf6);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 1.5rem;
      color: #fff;
    }
    .company-name {
      font-size: 1.5rem;
      font-weight: 700;
      color: #f1f5f9;
    }
    .company-location {
      font-size: 0.85rem;
      color: #64748b;
    }
    .company-rank {
      background: linear-gradient(135deg, #f59e0b, #ef4444);
      padding: 0.25rem 0.75rem;
      border-radius: 100px;
      font-size: 0.75rem;
      font-weight: 700;
    }
    .view-profile-btn {
      background: rgba(99, 102, 241, 0.2);
      color: #a5b4fc;
      padding: 0.5rem 1rem;
      border-radius: 100px;
      font-size: 0.85rem;
      font-weight: 600;
      border: 1px solid rgba(99, 102, 241, 0.3);
      display: flex;
      align-items: center;
      gap: 0.375rem;
      transition: all 0.2s;
    }
    .view-profile-btn:hover {
      background: rgba(99, 102, 241, 0.3);
      color: #fff;
    }

    /* Section Labels */
    .section-label {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.25rem 0.75rem;
      border-radius: 100px;
      font-size: 0.7rem;
      font-weight: 600;
      text-transform: uppercase;
      margin-bottom: 0.5rem;
    }
    .label-timeline { background: rgba(16, 185, 129, 0.2); color: #6ee7b7; }
    .label-3d { background: rgba(99, 102, 241, 0.2); color: #a5b4fc; }
    .label-2d { background: rgba(59, 130, 246, 0.2); color: #93c5fd; }

    /* Graph containers */
    .graph-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
      margin-top: 1rem;
    }
    @media (max-width: 900px) {
      .graph-row { grid-template-columns: 1fr; }
    }
    .graph-container {
      background: rgba(15, 23, 42, 0.5);
      border-radius: 0.75rem;
      border: 1px solid rgba(51, 65, 85, 0.3);
      overflow: hidden;
    }
    .graph-3d { height: 320px; }
    .graph-2d { height: 320px; }

    /* Footer */
    .page-footer {
      padding: 3rem 1.5rem;
      text-align: center;
      border-top: 1px solid rgba(51, 65, 85, 0.3);
      margin-top: 2rem;
    }
    .page-footer p { color: #64748b; font-size: 0.85rem; }
    .page-footer a { color: #6366f1; }
  </style>
</head>
<body>
  <Navigation currentPage="visualizations" />

  <div class="hero">
    <div class="hero-badge">
      <svg style="width: 1rem; height: 1rem;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
      </svg>
      Company Knowledge Graphs
    </div>
    <h1>Company Visualizations</h1>
    <p>Explore interactive knowledge graphs for each placement agent - see their deal networks, relationships, and historical timelines.</p>
  </div>

  <div class="container">
    {companies.map((company: any, index: number) => (
      <div class="company-card">
        <div class="company-header">
          <div class="company-info">
            <div class="company-avatar">
              {(company.display_name || company.name).charAt(0)}
            </div>
            <div>
              <div class="company-name">{company.display_name || company.name}</div>
              {company.headquarters && (
                <div class="company-location">{company.headquarters}</div>
              )}
            </div>
            {company.global_rank && company.global_rank <= 10 && (
              <span class="company-rank">#{company.global_rank}</span>
            )}
          </div>
          <a href={`/private-equity-placement-agents-list/${company.slug}`} class="view-profile-btn">
            View Full Profile
            <svg style="width: 0.875rem; height: 0.875rem;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
            </svg>
          </a>
        </div>

        <!-- Timeline -->
        <div style="margin-bottom: 1.5rem;">
          <span class="section-label label-timeline">Timeline</span>
          <span style="color: #64748b; font-size: 0.75rem; margin-left: 0.5rem;">Company history & milestones</span>
          <CompanyTimeline companyId={company.slug} companyName={company.name} />
        </div>

        <!-- 3D and 2D Graphs -->
        <div class="graph-row">
          <div>
            <span class="section-label label-3d">3D WebGL</span>
            <span style="color: #64748b; font-size: 0.7rem; margin-left: 0.5rem;">Interactive</span>
            <div class="graph-container graph-3d">
              <ZepGraph3D companyId={company.slug} companyName={company.name} height="320px" />
            </div>
          </div>
          <div>
            <span class="section-label label-2d">2D Network</span>
            <span style="color: #64748b; font-size: 0.7rem; margin-left: 0.5rem;">Accessible</span>
            <div class="graph-container graph-2d">
              <ZepGraphVisualization companyId={company.slug} companyName={company.name} />
            </div>
          </div>
        </div>

        <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid rgba(51, 65, 85, 0.3); display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 0.5rem;">
          <span style="font-size: 0.7rem; color: #64748b;">Drag to rotate • Scroll to zoom • Click nodes to explore</span>
          <span style="font-size: 0.7rem; color: #94a3b8;">Data from Knowledge Graph</span>
        </div>
      </div>
    ))}
  </div>

  <div class="page-footer">
    <p>
      <a href="/ecosystem">Explore PE Ecosystem Universe</a> •
      <a href="/deal-visualizations">View Deal Flow</a> •
      <a href="/private-equity-placement-agents-list">Browse All Agents</a>
    </p>
  </div>
</body>
</html>
