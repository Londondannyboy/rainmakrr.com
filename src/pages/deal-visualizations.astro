---
/**
 * Deal Visualizations Page
 *
 * A gallery of interactive knowledge graph visualizations for all placement agents
 * Features: Deal Timeline 3D, Company Networks, Historical Timelines
 */
import { sql } from '../lib/db';
import SEO from '../components/SEO.astro';
import Navigation from '../components/Navigation.astro';
import ZepGraph3D from '../components/ZepGraph3D.astro';
import ZepGraphVisualization from '../components/ZepGraphVisualization.astro';
import CompanyTimeline from '../components/CompanyTimeline.astro';
import DealTimeline3D from '../components/DealTimeline3D.astro';

// Fetch all companies with published status
const companies = await sql`
  SELECT
    id, name, slug,
    COALESCE(display_name, name) as display_name,
    description, headquarters,
    featured_asset_url, logo_url
  FROM companies
  WHERE status = 'published' AND company_type = 'placement_agent'
  ORDER BY
    CASE WHEN global_rank IS NOT NULL THEN 0 ELSE 1 END,
    global_rank ASC NULLS LAST,
    name ASC
  LIMIT 30
`;
---

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <SEO
    title="Deal Visualizations | Private Equity Placement Agents Network"
    description="Interactive 3D knowledge graph visualizations showing deal networks, relationships, and timelines for top private equity placement agents."
  />

  <!-- Preconnect for performance -->
  <link rel="preconnect" href="https://unpkg.com" crossorigin>

  <!-- Load visualization libraries -->
  <script src="https://unpkg.com/vis-network@9.1.9/standalone/umd/vis-network.min.js" defer></script>
  <script src="https://unpkg.com/3d-force-graph@1.79.0" defer></script>

  <style is:inline>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html { scroll-behavior: smooth; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(to bottom right, #020617, #0f172a, #020617);
      color: #f1f5f9;
      min-height: 100vh;
      line-height: 1.6;
    }
    a { color: inherit; text-decoration: none; }

    .container { max-width: 1400px; margin: 0 auto; padding: 0 1.5rem; }

    /* Hero */
    .hero {
      padding: 8rem 1.5rem 4rem;
      text-align: center;
      background: radial-gradient(ellipse at top, rgba(99, 102, 241, 0.15) 0%, transparent 50%);
    }
    .hero-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      background: rgba(99, 102, 241, 0.2);
      border: 1px solid rgba(99, 102, 241, 0.3);
      padding: 0.5rem 1rem;
      border-radius: 100px;
      font-size: 0.8rem;
      color: #a5b4fc;
      margin-bottom: 1.5rem;
    }
    .hero h1 {
      font-size: clamp(2rem, 5vw, 3.5rem);
      font-weight: 800;
      margin-bottom: 1rem;
      background: linear-gradient(to right, #fff, #a5b4fc);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .hero p {
      font-size: 1.1rem;
      color: #94a3b8;
      max-width: 600px;
      margin: 0 auto;
    }

    /* Grid */
    .viz-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(500px, 1fr));
      gap: 2rem;
      padding: 2rem 0 4rem;
    }

    @media (max-width: 768px) {
      .viz-grid {
        grid-template-columns: 1fr;
      }
      .viz-two-col {
        grid-template-columns: 1fr !important;
      }
    }

    /* Card */
    .viz-card {
      background: rgba(15, 23, 42, 0.6);
      border: 1px solid rgba(51, 65, 85, 0.5);
      border-radius: 1rem;
      overflow: hidden;
      transition: border-color 0.3s, transform 0.3s;
    }
    .viz-card:hover {
      border-color: rgba(99, 102, 241, 0.5);
      transform: translateY(-4px);
    }
    .viz-card-header {
      padding: 1rem 1.25rem;
      border-bottom: 1px solid rgba(51, 65, 85, 0.3);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .viz-card-title {
      font-size: 1rem;
      font-weight: 700;
      color: #f1f5f9;
    }
    .viz-card-location {
      font-size: 0.75rem;
      color: #64748b;
    }
    .viz-card-body {
      padding: 0;
      height: 350px;
    }
    .viz-card-footer {
      padding: 1rem 1.25rem;
      border-top: 1px solid rgba(51, 65, 85, 0.3);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .viz-card-link {
      font-size: 0.8rem;
      color: #6366f1;
      display: flex;
      align-items: center;
      gap: 0.375rem;
    }
    .viz-card-link:hover {
      color: #818cf8;
    }

    /* Section Divider */
    .section-divider {
      text-align: center;
      padding: 4rem 1.5rem 2rem;
    }
    .section-divider h2 {
      font-size: 1.75rem;
      font-weight: 700;
      color: #f1f5f9;
      margin-bottom: 0.5rem;
    }
    .section-divider p {
      color: #64748b;
      font-size: 0.95rem;
    }

    /* Footer */
    .page-footer {
      padding: 3rem 1.5rem;
      text-align: center;
      border-top: 1px solid rgba(51, 65, 85, 0.3);
    }
    .page-footer p {
      color: #64748b;
      font-size: 0.85rem;
    }
    .page-footer a {
      color: #6366f1;
    }
  </style>
</head>
<body>
  <Navigation currentPage="visualizations" />

  <!-- Hero Section -->
  <div class="hero">
    <div class="hero-badge">
      <svg style="width: 1rem; height: 1rem;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
      </svg>
      Interactive Knowledge Graphs
    </div>
    <h1>Deal Visualizations</h1>
    <p>Explore interactive 3D network visualizations showing deal flows, relationships, and connections for leading private equity placement agents.</p>
  </div>

  <!-- Featured: Deal Flow Timeline 3D -->
  <div class="container">
    <div style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(168, 85, 247, 0.1)); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 1rem; padding: 1.5rem; margin-bottom: 3rem;">
      <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem; flex-wrap: wrap; gap: 1rem;">
        <div style="display: flex; align-items: center; gap: 0.75rem;">
          <div style="width: 2.5rem; height: 2.5rem; border-radius: 0.75rem; background: linear-gradient(135deg, #ef4444, #f59e0b); display: flex; align-items: center; justify-content: center;">
            <svg style="width: 1.5rem; height: 1.5rem; color: #fff;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
            </svg>
          </div>
          <div>
            <h2 style="font-size: 1.5rem; font-weight: 700; color: #f1f5f9;">Deal Flow Timeline</h2>
            <p style="font-size: 0.8rem; color: #94a3b8;">Real-time 3D visualization of PE deals and market events</p>
          </div>
        </div>
        <div style="display: flex; gap: 0.5rem;">
          <span style="background: rgba(239, 68, 68, 0.2); color: #fca5a5; padding: 0.25rem 0.75rem; border-radius: 100px; font-size: 0.7rem; font-weight: 600; border: 1px solid rgba(239, 68, 68, 0.3);">LIVE</span>
          <span style="background: rgba(99, 102, 241, 0.2); color: #a5b4fc; padding: 0.25rem 0.75rem; border-radius: 100px; font-size: 0.7rem; font-weight: 600; border: 1px solid rgba(99, 102, 241, 0.3);">3D WebGL</span>
        </div>
      </div>
      <DealTimeline3D height="450px" />
    </div>
  </div>

  <!-- Section: Company Networks -->
  <div class="section-divider" style="padding-top: 1rem;">
    <h2>Company Knowledge Graphs</h2>
    <p>Explore each placement agent's network of deals, people, and relationships</p>
  </div>

  <!-- Company Visualization Gallery - Full Cards with Timeline + 2D/3D -->
  <div class="container">
    <div style="display: flex; flex-direction: column; gap: 3rem; padding: 2rem 0 4rem;">
      {companies.slice(0, 15).map((company: any) => (
        <div class="viz-card" style="padding: 1.5rem;">
          <!-- Header -->
          <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1.5rem; flex-wrap: wrap; gap: 1rem;">
            <div style="display: flex; align-items: center; gap: 1rem;">
              <div style="width: 3rem; height: 3rem; border-radius: 0.75rem; background: linear-gradient(135deg, #6366f1, #8b5cf6); display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 1.25rem; color: #fff;">
                {(company.display_name || company.name).charAt(0)}
              </div>
              <div>
                <div class="viz-card-title" style="font-size: 1.25rem;">{company.display_name || company.name}</div>
                {company.headquarters && (
                  <div class="viz-card-location">{company.headquarters}</div>
                )}
              </div>
            </div>
            <a href={`/private-equity-placement-agents-list/${company.slug}`} class="viz-card-link" style="background: rgba(99, 102, 241, 0.2); padding: 0.5rem 1rem; border-radius: 100px; border: 1px solid rgba(99, 102, 241, 0.3);">
              View Full Profile
              <svg style="width: 0.875rem; height: 0.875rem;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
              </svg>
            </a>
          </div>

          <!-- Timeline - Full Width -->
          <div style="margin-bottom: 1.5rem;">
            <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.75rem;">
              <span style="background: linear-gradient(135deg, #10b981, #14b8a6); padding: 0.2rem 0.6rem; border-radius: 100px; font-size: 0.65rem; font-weight: 600; text-transform: uppercase;">Timeline</span>
              <span style="color: #64748b; font-size: 0.75rem;">Company history & milestones</span>
            </div>
            <CompanyTimeline companyId={company.slug} companyName={company.name} />
          </div>

          <!-- 2D and 3D Side by Side -->
          <div class="viz-two-col" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
            <!-- 3D Graph -->
            <div>
              <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                <span style="background: linear-gradient(135deg, #6366f1, #8b5cf6); padding: 0.2rem 0.6rem; border-radius: 100px; font-size: 0.65rem; font-weight: 600; text-transform: uppercase;">3D WebGL</span>
                <span style="color: #64748b; font-size: 0.7rem;">Interactive</span>
              </div>
              <div style="height: 300px; background: rgba(15, 23, 42, 0.5); border-radius: 0.75rem; border: 1px solid rgba(51, 65, 85, 0.3); overflow: hidden;">
                <ZepGraph3D companyId={company.slug} companyName={company.name} height="300px" />
              </div>
            </div>

            <!-- 2D Graph -->
            <div>
              <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                <span style="background: linear-gradient(135deg, #3b82f6, #06b6d4); padding: 0.2rem 0.6rem; border-radius: 100px; font-size: 0.65rem; font-weight: 600; text-transform: uppercase;">2D Network</span>
                <span style="color: #64748b; font-size: 0.7rem;">Accessible</span>
              </div>
              <div style="height: 300px; background: rgba(15, 23, 42, 0.5); border-radius: 0.75rem; border: 1px solid rgba(51, 65, 85, 0.3); overflow: hidden;">
                <ZepGraphVisualization companyId={company.slug} companyName={company.name} />
              </div>
            </div>
          </div>

          <!-- Footer -->
          <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid rgba(51, 65, 85, 0.3); display: flex; align-items: center; justify-content: space-between;">
            <span style="font-size: 0.7rem; color: #64748b;">Drag to rotate • Scroll to zoom • Click nodes to explore</span>
            <span style="font-size: 0.7rem; color: #94a3b8;">Data from Knowledge Graph</span>
          </div>
        </div>
      ))}
    </div>
  </div>

  <!-- Footer -->
  <div class="page-footer">
    <p>
      Visualizations powered by our <a href="/">Knowledge Graph</a> •
      Data updated continuously from industry sources
    </p>
  </div>
</body>
</html>
