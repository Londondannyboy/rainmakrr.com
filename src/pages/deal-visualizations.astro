---
/**
 * Deal Visualizations Page
 *
 * Focused on deal flow visualizations - the Deal Timeline 3D
 * Company visualizations have been moved to /visualizations/companies
 */
import { sql } from '../lib/db';
import SEO from '../components/SEO.astro';
import Navigation from '../components/Navigation.astro';
import DealTimeline3D from '../components/DealTimeline3D.astro';

// Fetch recent deals/articles for stats
const recentArticles = await sql`
  SELECT id, title, slug, article_angle, published_at
  FROM articles
  WHERE app = 'rainmakrr' AND status = 'published'
  ORDER BY COALESCE(published_at, created_at) DESC
  LIMIT 50
`;

const dealCount = recentArticles.filter((a: any) =>
  a.title?.match(/acqui|merger|buyout|investment|raises|funding|stake|exit/i)
).length;
---

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <SEO
    title="Deal Flow Visualizations | Private Equity Deal Timeline"
    description="Interactive 3D visualization of private equity deal flows, market events, and transaction timelines. Track PE deals in real-time."
  />

  <link rel="preconnect" href="https://unpkg.com" crossorigin>
  <script src="https://unpkg.com/3d-force-graph@1.79.0" defer></script>

  <style is:inline>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html { scroll-behavior: smooth; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(to bottom right, #020617, #0f172a, #020617);
      color: #f1f5f9;
      min-height: 100vh;
      line-height: 1.6;
    }
    a { color: inherit; text-decoration: none; }
    .container { max-width: 1400px; margin: 0 auto; padding: 0 1.5rem; }

    /* Hero */
    .hero {
      padding: 7rem 1.5rem 3rem;
      text-align: center;
      background: radial-gradient(ellipse at top, rgba(239, 68, 68, 0.1) 0%, transparent 50%);
    }
    .hero-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      background: rgba(239, 68, 68, 0.2);
      border: 1px solid rgba(239, 68, 68, 0.3);
      padding: 0.5rem 1rem;
      border-radius: 100px;
      font-size: 0.8rem;
      color: #fca5a5;
      margin-bottom: 1.5rem;
    }
    .hero h1 {
      font-size: clamp(2rem, 5vw, 3.5rem);
      font-weight: 800;
      margin-bottom: 1rem;
      background: linear-gradient(to right, #fff, #fca5a5, #f59e0b);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .hero p {
      font-size: 1.1rem;
      color: #94a3b8;
      max-width: 650px;
      margin: 0 auto 2rem;
    }

    /* Stats */
    .stats-row {
      display: flex;
      justify-content: center;
      gap: 3rem;
      flex-wrap: wrap;
    }
    .stat-item {
      text-align: center;
    }
    .stat-value {
      font-size: 2.5rem;
      font-weight: 800;
      color: #fff;
    }
    .stat-value.highlight { color: #ef4444; }
    .stat-label {
      font-size: 0.8rem;
      color: #64748b;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* Main Visualization */
    .main-viz {
      background: linear-gradient(135deg, rgba(239, 68, 68, 0.05), rgba(168, 85, 247, 0.05));
      border: 1px solid rgba(239, 68, 68, 0.2);
      border-radius: 1.5rem;
      padding: 2rem;
      margin-bottom: 3rem;
    }
    .main-viz-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
      gap: 1rem;
    }
    .main-viz-title {
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    .main-viz-icon {
      width: 3.5rem;
      height: 3.5rem;
      border-radius: 1rem;
      background: linear-gradient(135deg, #ef4444, #f59e0b);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .main-viz-icon svg {
      width: 2rem;
      height: 2rem;
      color: #fff;
    }
    .main-viz h2 {
      font-size: 1.75rem;
      font-weight: 700;
      color: #fff;
    }
    .main-viz-subtitle {
      font-size: 0.9rem;
      color: #94a3b8;
    }
    .badges {
      display: flex;
      gap: 0.5rem;
    }
    .badge {
      padding: 0.35rem 0.85rem;
      border-radius: 100px;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
    }
    .badge-live {
      background: rgba(239, 68, 68, 0.2);
      color: #fca5a5;
      border: 1px solid rgba(239, 68, 68, 0.3);
    }
    .badge-3d {
      background: rgba(99, 102, 241, 0.2);
      color: #a5b4fc;
      border: 1px solid rgba(99, 102, 241, 0.3);
    }

    /* Links Section */
    .links-section {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 1.5rem;
      margin-bottom: 3rem;
    }
    .link-card {
      background: rgba(15, 23, 42, 0.6);
      border: 1px solid rgba(51, 65, 85, 0.5);
      border-radius: 1rem;
      padding: 1.5rem;
      transition: all 0.3s;
    }
    .link-card:hover {
      border-color: rgba(99, 102, 241, 0.5);
      transform: translateY(-4px);
    }
    .link-card-icon {
      width: 3rem;
      height: 3rem;
      border-radius: 0.75rem;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 1rem;
    }
    .link-card-icon svg {
      width: 1.5rem;
      height: 1.5rem;
      color: #fff;
    }
    .link-card h3 {
      font-size: 1.1rem;
      font-weight: 700;
      color: #fff;
      margin-bottom: 0.5rem;
    }
    .link-card p {
      font-size: 0.85rem;
      color: #64748b;
      margin-bottom: 1rem;
    }
    .link-card-cta {
      display: inline-flex;
      align-items: center;
      gap: 0.375rem;
      font-size: 0.85rem;
      color: #6366f1;
      font-weight: 600;
    }
    .link-card-cta:hover { color: #818cf8; }

    /* Footer */
    .page-footer {
      padding: 3rem 1.5rem;
      text-align: center;
      border-top: 1px solid rgba(51, 65, 85, 0.3);
    }
    .page-footer p { color: #64748b; font-size: 0.85rem; }
    .page-footer a { color: #6366f1; }
  </style>
</head>
<body>
  <Navigation currentPage="visualizations" />

  <div class="hero">
    <div class="hero-badge">
      <svg style="width: 1rem; height: 1rem;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
      </svg>
      Deal Flow Intelligence
    </div>
    <h1>Deal Flow Visualizations</h1>
    <p>Track private equity deals, market events, and transactions in real-time with our interactive 3D timeline visualization.</p>

    <div class="stats-row">
      <div class="stat-item">
        <div class="stat-value highlight">{dealCount}</div>
        <div class="stat-label">Recent Deals</div>
      </div>
      <div class="stat-item">
        <div class="stat-value">{recentArticles.length}</div>
        <div class="stat-label">Market Events</div>
      </div>
      <div class="stat-item">
        <div class="stat-value">3D</div>
        <div class="stat-label">WebGL Rendering</div>
      </div>
    </div>
  </div>

  <div class="container">
    <!-- Main Deal Timeline Visualization -->
    <div class="main-viz">
      <div class="main-viz-header">
        <div class="main-viz-title">
          <div class="main-viz-icon">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
            </svg>
          </div>
          <div>
            <h2>PE Deal Flow Timeline</h2>
            <p class="main-viz-subtitle">Interactive 3D visualization of market activity</p>
          </div>
        </div>
        <div class="badges">
          <span class="badge badge-live">Live Data</span>
          <span class="badge badge-3d">3D WebGL</span>
        </div>
      </div>

      <DealTimeline3D height="550px" maxDeals={30} />

      <div style="margin-top: 1.5rem; padding-top: 1rem; border-top: 1px solid rgba(51, 65, 85, 0.3); display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
        <span style="font-size: 0.8rem; color: #64748b;">Drag to rotate • Scroll to zoom • Hover for details</span>
        <span style="font-size: 0.8rem; color: #94a3b8;">Data extracted from market news</span>
      </div>
    </div>

    <!-- Related Visualizations -->
    <h3 style="font-size: 1.25rem; font-weight: 700; color: #fff; margin-bottom: 1.5rem; text-align: center;">Explore More Visualizations</h3>

    <div class="links-section">
      <a href="/ecosystem" class="link-card">
        <div class="link-card-icon" style="background: linear-gradient(135deg, #10b981, #14b8a6);">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064"></path>
          </svg>
        </div>
        <h3>PE Ecosystem Universe</h3>
        <p>Explore the full 3D universe of PE firms, placement agents, and their interconnections.</p>
        <span class="link-card-cta">
          Enter Universe
          <svg style="width: 0.875rem; height: 0.875rem;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
          </svg>
        </span>
      </a>

      <a href="/visualizations/companies" class="link-card">
        <div class="link-card-icon" style="background: linear-gradient(135deg, #6366f1, #8b5cf6);">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
          </svg>
        </div>
        <h3>Company Visualizations</h3>
        <p>Individual knowledge graphs for each placement agent showing deals, relationships, and timelines.</p>
        <span class="link-card-cta">
          View Companies
          <svg style="width: 0.875rem; height: 0.875rem;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
          </svg>
        </span>
      </a>

      <a href="/private-equity-placement-agents-list" class="link-card">
        <div class="link-card-icon" style="background: linear-gradient(135deg, #f59e0b, #ef4444);">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
          </svg>
        </div>
        <h3>Agent Directory</h3>
        <p>Browse our comprehensive directory of placement agents with profiles, rankings, and details.</p>
        <span class="link-card-cta">
          Browse Directory
          <svg style="width: 0.875rem; height: 0.875rem;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
          </svg>
        </span>
      </a>
    </div>
  </div>

  <div class="page-footer">
    <p>
      <a href="/ecosystem">PE Ecosystem</a> •
      <a href="/visualizations/companies">Company Graphs</a> •
      <a href="/">Home</a>
    </p>
  </div>
</body>
</html>
